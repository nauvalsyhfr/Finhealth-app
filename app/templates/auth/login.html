{% extends "base.html" %}

{% block title %}Masuk - FinHealth{% endblock %}

{% block body %}
<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--dark-bg); padding: 2rem; position: relative; overflow: hidden;">
    <!-- Animated Background -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;">
        <div style="position: absolute; width: 500px; height: 500px; background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%); top: -200px; right: -200px; animation: float 6s ease-in-out infinite;"></div>
        <div style="position: absolute; width: 400px; height: 400px; background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%); bottom: -150px; left: -150px; animation: float 8s ease-in-out infinite reverse;"></div>
    </div>

    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
    </style>

    <div class="card" style="max-width: 450px; width: 100%; box-shadow: var(--shadow-2xl); position: relative; z-index: 1; background: var(--dark-card); border: 1px solid var(--dark-border);">
        <div class="card-body" style="padding: 3rem;">
            <!-- Logo & Title -->
            <div style="text-align: center; margin-bottom: 2rem;">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="FinHealth Logo" style="height: 80px; margin-bottom: 1rem; filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.5));">
                <h1 style="background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem;">FinHealth</h1>
                <p style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: 0;">Healthy Finance, Happier Business</p>
            </div>

            <!-- Login Form -->
            <form id="loginForm">
                <div class="form-group">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" id="email" name="email" class="form-control" placeholder="nama@email.com" required style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" name="password" class="form-control" placeholder="••••••••" required style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                </div>

                <div class="form-group" style="display: flex; align-items: center;">
                    <input type="checkbox" id="remember" name="remember" style="margin-right: 0.5rem;">
                    <label for="remember" style="margin-bottom: 0; font-weight: 400; cursor: pointer; color: var(--text-secondary);">Ingat saya</label>
                </div>

                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; margin-top: 1rem;" id="loginBtn">
                    <span id="loginBtnText">Masuk</span>
                    <span id="loginBtnSpinner" class="d-none">
                        <div class="spinner" style="width: 20px; height: 20px; border-width: 2px;"></div>
                    </span>
                </button>
            </form>

            <!-- Register Link -->
            <div style="text-align: center; margin-top: 1.5rem;">
                <p style="color: var(--text-secondary); margin-bottom: 0;">
                    Belum punya akun? 
                    <a href="{{ url_for('auth.register') }}" style="font-weight: 600; color: var(--primary-color);">Daftar Sekarang</a>
                </p>
                <a href="{{ url_for('landing.index') }}" style="color: var(--text-muted); font-size: var(--font-size-sm); margin-top: 0.5rem; display: inline-block;">← Kembali ke Beranda</a>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const btn = document.getElementById('loginBtn');
    const btnText = document.getElementById('loginBtnText');
    const btnSpinner = document.getElementById('loginBtnSpinner');
    
    btn.disabled = true;
    btnText.classList.add('d-none');
    btnSpinner.classList.remove('d-none');
    
    const formData = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        remember: document.getElementById('remember').checked
    };
    
    try {
        const response = await fetch('{{ url_for("auth.login") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showAlert('success', data.message || 'Login berhasil!');
            setTimeout(() => {
                window.location.href = data.redirect || '{{ url_for("dashboard.index") }}';
            }, 500);
        } else {
            showAlert('danger', data.error || 'Login gagal. Silakan coba lagi.');
            btn.disabled = false;
            btnText.classList.remove('d-none');
            btnSpinner.classList.add('d-none');
        }
    } catch (error) {
        showAlert('danger', 'Terjadi kesalahan. Silakan coba lagi.');
        btn.disabled = false;
        btnText.classList.remove('d-none');
        btnSpinner.classList.add('d-none');
    }
});

function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} fade-in`;
    alertDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: var(--shadow-lg);';
    alertDiv.innerHTML = `
        ${message}
        <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 1.5rem; cursor: pointer; line-height: 1; color: inherit; opacity: 0.7;">&times;</button>
    `;
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        alertDiv.style.transition = 'opacity 0.5s';
        alertDiv.style.opacity = '0';
        setTimeout(() => alertDiv.remove(), 500);
    }, 5000);
}
</script>
{% endblock %}