{% extends "base.html" %}

{% block title %}Daftar - FinHealth{% endblock %}

{% block body %}
<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--dark-bg); padding: 2rem; position: relative; overflow: hidden;">
    <!-- Animated Background -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;">
        <div style="position: absolute; width: 500px; height: 500px; background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%); top: -200px; right: -200px; animation: float 6s ease-in-out infinite;"></div>
        <div style="position: absolute; width: 400px; height: 400px; background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%); bottom: -150px; left: -150px; animation: float 8s ease-in-out infinite reverse;"></div>
    </div>

    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
    </style>

    <div class="card" style="max-width: 600px; width: 100%; box-shadow: var(--shadow-2xl); position: relative; z-index: 1; background: var(--dark-card); border: 1px solid var(--dark-border);">
        <div class="card-body" style="padding: 3rem;">
            <!-- Logo & Title -->
            <div style="text-align: center; margin-bottom: 2rem;">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="FinHealth Logo" style="height: 70px; margin-bottom: 1rem; filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.5));">
                <h2 style="background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem;">Daftar Akun UMKM</h2>
                <p style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: 0;">Mulai kelola keuangan bisnis Anda dengan lebih baik</p>
            </div>

            <!-- Registration Form -->
            <form id="registerForm">
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <label for="nama_umkm" class="form-label">Nama UMKM <span style="color: var(--danger-color);">*</span></label>
                            <input type="text" id="nama_umkm" name="nama_umkm" class="form-control" placeholder="Contoh: Toko Sari Rasa" required style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-group">
                            <label for="email" class="form-label">Email <span style="color: var(--danger-color);">*</span></label>
                            <input type="email" id="email" name="email" class="form-control" placeholder="email@umkm.com" required style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                    
                    <div class="col-6">
                        <div class="form-group">
                            <label for="password" class="form-label">Password <span style="color: var(--danger-color);">*</span></label>
                            <input type="password" id="password" name="password" class="form-control" placeholder="Minimal 6 karakter" required minlength="6" style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                    
                    <div class="col-6">
                        <div class="form-group">
                            <label for="confirm_password" class="form-label">Konfirmasi Password <span style="color: var(--danger-color);">*</span></label>
                            <input type="password" id="confirm_password" name="confirm_password" class="form-control" placeholder="Ulangi password" required style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                    
                    <div class="col-6">
                        <div class="form-group">
                            <label for="nama_pemilik" class="form-label">Nama Pemilik</label>
                            <input type="text" id="nama_pemilik" name="nama_pemilik" class="form-control" placeholder="Nama lengkap Anda" style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                    
                    <div class="col-6">
                        <div class="form-group">
                            <label for="nomor_telepon" class="form-label">Nomor Telepon</label>
                            <input type="tel" id="nomor_telepon" name="nomor_telepon" class="form-control" placeholder="08xxxxxxxxxx" style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-group">
                            <label for="produk" class="form-label">Jenis Produk/Layanan</label>
                            <input type="text" id="produk" name="produk" class="form-control" placeholder="Contoh: Makanan & Minuman, Jasa Laundry" style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-group">
                            <label for="tanggal_berdiri" class="form-label">Tanggal Berdiri</label>
                            <input type="date" id="tanggal_berdiri" name="tanggal_berdiri" class="form-control" style="background: var(--dark-bg); color: var(--text-primary); border-color: var(--dark-border);">
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; margin-top: 1rem;" id="registerBtn">
                    <span id="registerBtnText">Daftar Sekarang</span>
                    <span id="registerBtnSpinner" class="d-none">
                        <div class="spinner" style="width: 20px; height: 20px; border-width: 2px;"></div>
                    </span>
                </button>
            </form>

            <!-- Login Link -->
            <div style="text-align: center; margin-top: 1.5rem;">
                <p style="color: var(--text-secondary); margin-bottom: 0;">
                    Sudah punya akun? 
                    <a href="{{ url_for('auth.login') }}" style="font-weight: 600; color: var(--primary-color);">Masuk di sini</a>
                </p>
                <a href="{{ url_for('landing.index') }}" style="color: var(--text-muted); font-size: var(--font-size-sm); margin-top: 0.5rem; display: inline-block;">‚Üê Kembali ke Beranda</a>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (password !== confirmPassword) {
        showAlert('danger', 'Password tidak cocok!');
        return;
    }
    
    const btn = document.getElementById('registerBtn');
    const btnText = document.getElementById('registerBtnText');
    const btnSpinner = document.getElementById('registerBtnSpinner');
    
    btn.disabled = true;
    btnText.classList.add('d-none');
    btnSpinner.classList.remove('d-none');
    
    const formData = {
        nama_umkm: document.getElementById('nama_umkm').value,
        email: document.getElementById('email').value,
        password: password,
        nama_pemilik: document.getElementById('nama_pemilik').value,
        nomor_telepon: document.getElementById('nomor_telepon').value,
        produk: document.getElementById('produk').value,
        tanggal_berdiri: document.getElementById('tanggal_berdiri').value
    };
    
    try {
        const response = await fetch('{{ url_for("auth.register") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showAlert('success', data.message || 'Registrasi berhasil!');
            setTimeout(() => {
                window.location.href = '{{ url_for("auth.login") }}';
            }, 1500);
        } else {
            showAlert('danger', data.error || 'Registrasi gagal. Silakan coba lagi.');
            btn.disabled = false;
            btnText.classList.remove('d-none');
            btnSpinner.classList.add('d-none');
        }
    } catch (error) {
        showAlert('danger', 'Terjadi kesalahan. Silakan coba lagi.');
        btn.disabled = false;
        btnText.classList.remove('d-none');
        btnSpinner.classList.add('d-none');
    }
});

function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} fade-in`;
    alertDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: var(--shadow-lg);';
    alertDiv.innerHTML = `
        ${message}
        <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 1.5rem; cursor: pointer; line-height: 1; color: inherit; opacity: 0.7;">&times;</button>
    `;
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        alertDiv.style.transition = 'opacity 0.5s';
        alertDiv.style.opacity = '0';
        setTimeout(() => alertDiv.remove(), 500);
    }, 5000);
}
</script>
{% endblock %}